<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>408 æ™ºèƒ½å¤ä¹ è®¡åˆ’</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap');
        body {
            font-family: 'Noto Sans SC', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        .view-container {
            transition: opacity 0.4s ease-in-out, transform 0.4s ease-in-out;
        }
        .hidden-view {
            opacity: 0;
            transform: scale(0.98);
            pointer-events: none;
            position: absolute;
            width: 100%;
        }
        .plan-item, .stat-item, .timeline-item {
            transform: translateY(20px);
            opacity: 0;
            animation: fadeIn 0.5s ease-out forwards;
        }
        @keyframes fadeIn {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        .custom-checkbox:checked {
            background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
            background-color: #4f46e5;
            border-color: #4f46e5;
        }
        .modal-backdrop.hidden { display: none; }
        .modal-content { animation: slide-up 0.3s ease-out; }
        @keyframes slide-up {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #fff;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        input[type=range] {
            -webkit-appearance: none; appearance: none;
            width: 100%; height: 8px; background: #374151;
            border-radius: 5px; outline: none; transition: background 0.3s;
        }
        input[type=range]:hover { background: #4b5563; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none;
            width: 24px; height: 24px; background: #6366f1;
            cursor: pointer; border-radius: 50%; border: 4px solid #111827;
        }
        input[type=range]::-moz-range-thumb {
            width: 24px; height: 24px; background: #6366f1;
            cursor: pointer; border-radius: 50%; border: 4px solid #111827;
        }
        .weight-btn-group button.active {
            background-color: #4f46e5;
            color: white;
            font-weight: bold;
        }
        .calendar-grid {
            grid-template-columns: repeat(7, minmax(0, 1fr));
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 flex flex-col items-center min-h-screen p-4">
<div class="w-full max-w-4xl mx-auto">
    <header class="text-left mb-6">
        <h1 class="text-xl font-bold text-white">408ä»Šå¤©å­¦ä»€ä¹ˆ</h1>
        <p class="text-xs text-gray-500">CS408 Today</p>
    </header>

    <main class="relative">
        <!-- ä¸»ç•Œé¢/ä»ªè¡¨ç›˜å®¹å™¨ -->
        <div id="dashboard-container" class="view-container text-center"></div>

        <!-- è®¾ç½®é¡µé¢å®¹å™¨ -->
        <div id="settings-container" class="view-container hidden-view w-full text-left"></div>

        <!-- å¤ä¹ è®¡åˆ’å®¹å™¨ -->
        <div id="plan-container" class="view-container hidden-view w-full text-left"></div>

        <!-- å¤ä¹ ç»Ÿè®¡ä¸»é¡µå®¹å™¨ -->
        <div id="stats-main-container" class="view-container hidden-view w-full text-left"></div>

        <!-- ç« èŠ‚ç»Ÿè®¡è¯¦æƒ…é¡µå®¹å™¨ -->
        <div id="chapter-detail-container" class="view-container hidden-view w-full text-left"></div>

        <!-- å†å²è®¡åˆ’è¯¦æƒ…é¡µå®¹å™¨ -->
        <div id="history-detail-container" class="view-container hidden-view w-full text-left"></div>

        <!-- å®Œæ•´æ—¥å†å®¹å™¨ -->
        <div id="full-calendar-container" class="view-container hidden-view w-full text-left"></div>
    </main>
</div>

<footer class="text-center mt-8 text-xs text-gray-600">
    <p>Crafted by Nyto4223 & Gemini</p>
</footer>

<!-- Modals -->
<div id="ai-modal-backdrop" class="modal-backdrop fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 hidden z-50">
    <div id="ai-modal-content" class="modal-content bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col">
        <div class="flex justify-between items-center p-4 border-b border-gray-700">
            <h3 id="ai-modal-title" class="text-xl font-bold text-white">âœ¨ AI åŠ©æ•™</h3>
            <button class="modal-close text-gray-400 hover:text-white">&times;</button>
        </div>
        <div class="p-6 overflow-y-auto"><div id="ai-loading" class="flex flex-col items-center justify-center text-center"><div class="spinner"></div><p class="mt-4 text-gray-300">AI æ­£åœ¨æ€è€ƒä¸­...</p></div><div id="ai-result" class="text-gray-300 whitespace-pre-wrap"></div></div>
    </div>
</div>

<div id="notes-modal-backdrop" class="modal-backdrop fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 hidden z-50">
    <div id="notes-modal-content" class="modal-content bg-gray-800 rounded-lg shadow-xl w-full max-w-xl flex flex-col">
        <div class="flex justify-between items-center p-4 border-b border-gray-700"><h3 id="notes-modal-title" class="text-xl font-bold text-white">å¤ä¹ ç¬”è®°</h3><button class="modal-close text-gray-400 hover:text-white">&times;</button></div>
        <div class="p-6"><textarea id="notes-textarea" class="w-full h-48 bg-gray-700 text-gray-200 p-3 rounded-md focus:ring-2 focus:ring-indigo-500" placeholder="åœ¨æ­¤è¾“å…¥ä½ çš„ç¬”è®°ã€æ€»ç»“æˆ–ç–‘é—®..."></textarea><div class="text-right mt-4"><button id="save-note-btn" class="bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-indigo-500 transition-colors">ä¿å­˜</button></div></div>
    </div>
</div>

<div id="api-key-modal-backdrop" class="modal-backdrop fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 hidden z-50">
    <div id="api-key-modal-content" class="modal-content bg-gray-800 rounded-lg shadow-xl w-full max-w-md flex flex-col">
        <div class="flex justify-between items-center p-4 border-b border-gray-700">
            <h3 class="text-xl font-bold text-white">é…ç½® AI API å¯†é’¥</h3>
            <button id="api-key-modal-close" class="modal-close text-gray-400 hover:text-white">&times;</button>
        </div>
        <div class="p-6 space-y-4">
            <p class="text-gray-400 text-sm">ä¸ºäº†ä½¿ç”¨AIåŠ©æ•™åŠŸèƒ½ï¼Œè¯·ä» Google AI Studio è·å–å¹¶è¾“å…¥æ‚¨çš„ Gemini API å¯†é’¥ã€‚å¯†é’¥å°†è¢«å®‰å…¨åœ°ä¿å­˜åœ¨æ‚¨çš„æµè§ˆå™¨æœ¬åœ°ã€‚</p>
            <input type="password" id="api-key-input" class="w-full bg-gray-700 text-gray-200 p-2 rounded-md focus:ring-2 focus:ring-indigo-500" placeholder="AIzaSy...">
            <div class="text-right">
                <button id="save-api-key-btn" class="bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-indigo-500 transition-colors">ä¿å­˜å¯†é’¥</button>
            </div>
        </div>
    </div>
</div>

<script>
    // --- æ•°æ®å®šä¹‰åŒº ---
    const SYLLABUS = [
        ["æ•°æ®ç»“æ„", "ç¬¬ä¸€ç«  ç»ªè®º", "æ•°æ®ç»“æ„çš„åŸºæœ¬æ¦‚å¿µ", 10, ["concept"], ["ç†è§£å¹¶åŒºåˆ†æ•°æ®çš„é€»è¾‘ç»“æ„ï¼ˆçº¿æ€§ç»“æ„ã€æ ‘å½¢ç»“æ„ã€å›¾ç»“æ„ã€é›†åˆï¼‰ä¸å­˜å‚¨ç»“æ„ï¼ˆé¡ºåºå­˜å‚¨ã€é“¾å¼å­˜å‚¨ã€ç´¢å¼•å­˜å‚¨ã€æ•£åˆ—å­˜å‚¨ï¼‰ï¼Œä»¥åŠå®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚"]],
        ["æ•°æ®ç»“æ„", "ç¬¬ä¸€ç«  ç»ªè®º", "ç®—æ³•çš„åŸºæœ¬æ¦‚å¿µ", 25, ["algorithm", "complexity"], ["æŒæ¡ç®—æ³•çš„äº”ä¸ªåŸºæœ¬ç‰¹æ€§ï¼ˆæœ‰ç©·æ€§ã€ç¡®å®šæ€§ã€å¯è¡Œæ€§ã€è¾“å…¥ã€è¾“å‡ºï¼‰ã€‚", "ç†è§£ç®—æ³•è®¾è®¡çš„è¦æ±‚ï¼ˆæ­£ç¡®æ€§ã€å¯è¯»æ€§ã€å¥å£®æ€§ã€é«˜æ•ˆç‡ä¸ä½å­˜å‚¨é‡éœ€æ±‚ï¼‰ã€‚", "ï¼ˆé‡ç‚¹ï¼‰æŒæ¡æ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦çš„åˆ†ææ–¹æ³•ï¼Œèƒ½å¤Ÿåˆ†æå¸¸è§å¾ªç¯å’Œé€’å½’ç®—æ³•çš„å¤æ‚åº¦ã€‚"]],
        ["æ•°æ®ç»“æ„", "ç¬¬äºŒç«  çº¿æ€§è¡¨", "çº¿æ€§è¡¨çš„åŸºæœ¬æ¦‚å¿µä¸å®ç°", 40, ["linear_list", "storage"], ["ç†è§£çº¿æ€§è¡¨çš„å®šä¹‰å’ŒåŸºæœ¬æ“ä½œï¼ˆå¢ã€åˆ ã€æ”¹ã€æŸ¥ï¼‰ã€‚", "æŒæ¡é¡ºåºè¡¨çš„å®šä¹‰ã€ç‰¹ç‚¹ï¼ˆéšæœºå­˜å–ï¼‰ï¼Œå¹¶èƒ½åˆ†æå…¶æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾æ“ä½œçš„æ€§èƒ½ã€‚", "æŒæ¡å•é“¾è¡¨ã€åŒå‘é“¾è¡¨ã€å¾ªç¯é“¾è¡¨çš„ç»“æ„å’ŒåŸºæœ¬æ“ä½œå®ç°ï¼ˆå¤´æ’æ³•ã€å°¾æ’æ³•ã€æ’å…¥ã€åˆ é™¤ï¼‰ã€‚"]],
        ["æ•°æ®ç»“æ„", "ç¬¬ä¸‰ç«  æ ˆã€é˜Ÿåˆ—å’Œæ•°ç»„", "æ ˆå’Œé˜Ÿåˆ—", 40, ["stack", "queue"], ["ç†è§£æ ˆçš„â€œåè¿›å…ˆå‡ºâ€(LIFO)å’Œé˜Ÿåˆ—çš„â€œå…ˆè¿›å…ˆå‡ºâ€(FIFO)ç‰¹æ€§ã€‚", "æŒæ¡é¡ºåºæ ˆå’Œé“¾æ ˆçš„å®ç°ã€‚", "ï¼ˆé‡ç‚¹ï¼‰æŒæ¡å¾ªç¯é˜Ÿåˆ—çš„å®ç°ï¼Œç‰¹åˆ«æ˜¯é˜Ÿç©ºå’Œé˜Ÿæ»¡çš„åˆ¤æ–­æ¡ä»¶ã€‚", "æŒæ¡é“¾é˜Ÿåˆ—çš„å®ç°ã€‚"]],
        ["æ•°æ®ç»“æ„", "ç¬¬ä¸‰ç«  æ ˆã€é˜Ÿåˆ—å’Œæ•°ç»„", "æ•°ç»„ä¸ç‰¹æ®ŠçŸ©é˜µ", 30, ["array", "matrix", "storage"], ["ç†è§£æ•°ç»„æŒ‰è¡Œä¼˜å…ˆå’Œåˆ—ä¼˜å…ˆçš„å­˜å‚¨æ–¹å¼ï¼Œå¹¶èƒ½è¿›è¡Œåœ°å€è®¡ç®—ã€‚", "æŒæ¡å¯¹ç§°çŸ©é˜µã€ä¸‰è§’çŸ©é˜µã€ç¨€ç–çŸ©é˜µçš„å‹ç¼©å­˜å‚¨æ–¹æ³•ã€‚"]],
        ["æ•°æ®ç»“æ„", "ç¬¬ä¸‰ç«  æ ˆã€é˜Ÿåˆ—å’Œæ•°ç»„", "æ ˆã€é˜Ÿåˆ—å’Œæ•°ç»„çš„åº”ç”¨", 25, ["application"], ["ç†è§£æ ˆåœ¨è¡¨è¾¾å¼æ±‚å€¼ã€æ‹¬å·åŒ¹é…ã€å‡½æ•°è°ƒç”¨ä¸­çš„åº”ç”¨ï¼›é˜Ÿåˆ—åœ¨å±‚æ¬¡éå†ã€ç¼“å†²åŒºä¸­çš„åº”ç”¨ã€‚"]],
        ["æ•°æ®ç»“æ„", "ç¬¬å››ç«  æ ‘ä¸äºŒå‰æ ‘", "æ ‘ä¸äºŒå‰æ ‘çš„åŸºæœ¬æ¦‚å¿µ", 40, ["tree"], ["æŒæ¡æ ‘çš„å®šä¹‰ã€åº¦ã€æ·±åº¦ã€å¶å­èŠ‚ç‚¹ç­‰åŸºæœ¬æœ¯è¯­ã€‚", "æŒæ¡äºŒå‰æ ‘çš„5ä¸ªé‡è¦æ€§è´¨ã€‚", "æŒæ¡äºŒå‰æ ‘çš„é¡ºåºå­˜å‚¨ï¼ˆä»…é™å®Œå…¨äºŒå‰æ ‘ï¼‰å’Œé“¾å¼å­˜å‚¨ã€‚"]],
        ["æ•°æ®ç»“æ„", "ç¬¬å››ç«  æ ‘ä¸äºŒå‰æ ‘", "äºŒå‰æ ‘çš„éå†ä¸çº¿ç´¢åŒ–", 35, ["traversal"], ["ï¼ˆé‡ç‚¹ï¼‰ç†Ÿç»ƒæŒæ¡å…ˆåºã€ä¸­åºã€ååºéå†çš„é€’å½’å’Œéé€’å½’ï¼ˆä½¿ç”¨æ ˆï¼‰å®ç°ï¼Œä»¥åŠå±‚æ¬¡éå†ï¼ˆä½¿ç”¨é˜Ÿåˆ—ï¼‰çš„å®ç°ã€‚", "ç†è§£çº¿ç´¢äºŒå‰æ ‘çš„ç›®çš„ï¼Œèƒ½ç”»å‡ºäºŒå‰æ ‘çš„çº¿ç´¢åŒ–ç»“æœã€‚"]],
        ["æ•°æ®ç»“æ„", "ç¬¬å››ç«  æ ‘ä¸äºŒå‰æ ‘", "æ ‘ã€æ£®æ—", 25, ["tree"], ["æŒæ¡æ ‘çš„åŒäº²è¡¨ç¤ºæ³•ã€å­©å­è¡¨ç¤ºæ³•ã€å­©å­å…„å¼Ÿè¡¨ç¤ºæ³•ã€‚", "æŒæ¡æ ‘ã€æ£®æ—ä¸äºŒå‰æ ‘çš„ç›¸äº’è½¬æ¢æ–¹æ³•åŠéå†ã€‚"]],
        ["æ•°æ®ç»“æ„", "ç¬¬å››ç«  æ ‘ä¸äºŒå‰æ ‘", "æ ‘ä¸äºŒå‰æ ‘çš„åº”ç”¨", 45, ["application", "huffman", "heap"], ["ï¼ˆé‡ç‚¹ï¼‰ç†è§£å“ˆå¤«æ›¼æ ‘çš„æ„é€ è¿‡ç¨‹ï¼Œè®¡ç®—å¸¦æƒè·¯å¾„é•¿åº¦(WPL)ï¼Œæ„é€ å“ˆå¤«æ›¼ç¼–ç ã€‚", "ç†è§£å¹¶æŸ¥é›†çš„åŸºæœ¬æ“ä½œï¼ˆFind, Unionï¼‰ï¼ŒæŒæ¡è·¯å¾„å‹ç¼©å’ŒæŒ‰ç§©åˆå¹¶ä¼˜åŒ–ã€‚", "ï¼ˆæ–°å¢é‡ç‚¹ï¼‰æŒæ¡å¤§æ ¹å †ã€å°æ ¹å †çš„å®šä¹‰ï¼Œä»¥åŠåœ¨å †ä¸Šè¿›è¡Œæ’å…¥å’Œåˆ é™¤å…ƒç´ çš„æ“ä½œï¼ˆå‘ä¸Šè°ƒæ•´ã€å‘ä¸‹è°ƒæ•´ï¼‰ï¼Œç†è§£å †æ’åºçš„å®ç°ã€‚"]],
        ["æ•°æ®ç»“æ„", "ç¬¬äº”ç«  å›¾", "å›¾çš„æ¦‚å¿µä¸å­˜å‚¨", 30, ["graph", "storage"], ["æŒæ¡æœ‰å‘å›¾ã€æ— å‘å›¾ã€é¡¶ç‚¹çš„åº¦ã€è·¯å¾„ã€è¿é€šæ€§ç­‰åŸºæœ¬æ¦‚å¿µã€‚", "æŒæ¡é‚»æ¥çŸ©é˜µå’Œé‚»æ¥è¡¨çš„è¡¨ç¤ºæ–¹æ³•ã€ç‰¹ç‚¹åŠé€‚ç”¨åœºæ™¯ã€‚äº†è§£é‚»æ¥å¤šé‡è¡¨ã€åå­—é“¾è¡¨ã€‚"]],
        ["æ•°æ®ç»“æ„", "ç¬¬äº”ç«  å›¾", "å›¾çš„éå†", 25, ["graph", "traversal"], ["ï¼ˆé‡ç‚¹ï¼‰ç†Ÿç»ƒæŒæ¡æ·±åº¦ä¼˜å…ˆæœç´¢(DFS)å’Œå¹¿åº¦ä¼˜å…ˆæœç´¢(BFS)çš„ç®—æ³•æ€æƒ³ã€å®ç°è¿‡ç¨‹å’Œæ—¶ç©ºå¤æ‚åº¦ã€‚"]],
        ["æ•°æ®ç»“æ„", "ç¬¬äº”ç«  å›¾", "å›¾çš„åŸºæœ¬åº”ç”¨", 50, ["graph", "application"], ["ï¼ˆé‡ç‚¹ï¼‰æŒæ¡Primç®—æ³•å’ŒKruskalç®—æ³•çš„æ€æƒ³å’Œæ‰§è¡Œè¿‡ç¨‹ã€‚", "ï¼ˆé‡ç‚¹ï¼‰æŒæ¡Dijkstraç®—æ³•ï¼ˆå•æºï¼‰å’ŒFloydç®—æ³•ï¼ˆæ‰€æœ‰é¡¶ç‚¹å¯¹ï¼‰çš„æ€æƒ³å’Œæ‰§è¡Œè¿‡ç¨‹ã€‚", "ç†è§£AOVç½‘ï¼ŒæŒæ¡æ‹“æ‰‘æ’åºçš„å®ç°æ–¹æ³•ã€‚", "ç†è§£AOEç½‘ï¼ŒæŒæ¡æ±‚è§£å…³é”®è·¯å¾„å’Œå…³é”®æ´»åŠ¨çš„æ­¥éª¤ã€‚"]],
        ["æ•°æ®ç»“æ„", "ç¬¬å…­ç«  æŸ¥æ‰¾", "çº¿æ€§æŸ¥æ‰¾", 30, ["search"], ["ç†è§£é¡ºåºæŸ¥æ‰¾ã€æŠ˜åŠæŸ¥æ‰¾ï¼ˆäºŒåˆ†æŸ¥æ‰¾ï¼‰ã€åˆ†å—æŸ¥æ‰¾çš„åŸç†ã€å®ç°å’Œæ€§èƒ½åˆ†æã€‚"]],
        ["æ•°æ®ç»“æ„", "ç¬¬å…­ç«  æŸ¥æ‰¾", "æ ‘å‹æŸ¥æ‰¾", 45, ["search", "tree"], ["æŒæ¡äºŒå‰æœç´¢æ ‘ (BST)çš„å®šä¹‰ã€æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤æ“ä½œã€‚", "ï¼ˆé‡ç‚¹ï¼‰ç†è§£AVLæ ‘çš„å¹³è¡¡å› å­ï¼ŒæŒæ¡å››ç§å¹³è¡¡è°ƒæ•´ï¼ˆLL, RR, LR, RLæ—‹è½¬ï¼‰çš„æ–¹æ³•ã€‚", "æŒæ¡çº¢é»‘æ ‘çš„5æ¡åŸºæœ¬æ€§è´¨ã€‚"]],
        ["æ•°æ®ç»“æ„", "ç¬¬å…­ç«  æŸ¥æ‰¾", "Bæ ‘ä¸B+æ ‘", 35, ["search", "b_tree"], ["ï¼ˆé‡ç‚¹ï¼‰ç†è§£Bæ ‘çš„å®šä¹‰ï¼ŒæŒæ¡å…¶æ’å…¥ï¼ˆåˆ†è£‚ï¼‰å’Œåˆ é™¤ï¼ˆåˆå¹¶/å€Ÿä½ï¼‰æ“ä½œçš„è¿‡ç¨‹ã€‚", "ç†è§£B+æ ‘çš„åŸºæœ¬æ¦‚å¿µåŠå…¶ä¸Bæ ‘çš„åŒºåˆ«ã€‚"]],
        ["æ•°æ®ç»“æ„", "ç¬¬å…­ç«  æŸ¥æ‰¾", "æ•£åˆ—è¡¨(Hash Table)", 30, ["search", "hash"], ["ï¼ˆé‡ç‚¹ï¼‰ç†è§£å“ˆå¸Œå‡½æ•°çš„æ„é€ ï¼Œç†Ÿç»ƒæŒæ¡å¤„ç†å“ˆå¸Œå†²çªçš„é“¾åœ°å€æ³•å’Œå¼€æ”¾å®šå€æ³•ï¼ˆçº¿æ€§æ¢æµ‹ã€å¹³æ–¹æ¢æµ‹ç­‰ï¼‰ã€‚", "ä¼šè®¡ç®—å¹³å‡æŸ¥æ‰¾é•¿åº¦(ASL)ã€‚"]],
        ["æ•°æ®ç»“æ„", "ç¬¬å…­ç«  æŸ¥æ‰¾", "å­—ç¬¦ä¸²æ¨¡å¼åŒ¹é…", 35, ["string", "kmp"], ["ï¼ˆé‡ç‚¹ï¼‰ç†è§£å¹¶æŒæ¡KMPç®—æ³•ä¸­nextæ•°ç»„çš„è®¡ç®—æ–¹æ³•å’ŒåŒ¹é…è¿‡ç¨‹ã€‚"]],
        ["æ•°æ®ç»“æ„", "ç¬¬ä¸ƒç«  æ’åº", "æ’å…¥ã€äº¤æ¢ã€é€‰æ‹©æ’åº", 45, ["sort"], ["ç†Ÿç»ƒæŒæ¡ç›´æ¥æ’å…¥æ’åºã€å¸Œå°”æ’åºã€å†’æ³¡æ’åºã€å¿«é€Ÿæ’åºã€ç®€å•é€‰æ‹©æ’åºã€å †æ’åºçš„æ€æƒ³ã€å®ç°ã€æ—¶ç©ºå¤æ‚åº¦åŠç¨³å®šæ€§ã€‚"]],
        ["æ•°æ®ç»“æ„", "ç¬¬ä¸ƒç«  æ’åº", "å½’å¹¶ä¸åŸºæ•°æ’åº", 35, ["sort"], ["ç†Ÿç»ƒæŒæ¡äºŒè·¯å½’å¹¶æ’åºå’ŒåŸºæ•°æ’åºçš„æ€æƒ³ã€å®ç°ã€æ—¶ç©ºå¤æ‚åº¦åŠç¨³å®šæ€§ã€‚"]],
        ["æ•°æ®ç»“æ„", "ç¬¬ä¸ƒç«  æ’åº", "å¤–éƒ¨æ’åº", 20, ["sort", "external"], ["ç†è§£å¤–éƒ¨æ’åºçš„åŸºæœ¬æ€æƒ³å’Œå¤šè·¯å½’å¹¶çš„è¿‡ç¨‹ã€‚"]],
        ["è®¡ç®—æœºç»„æˆåŸç†", "ç¬¬ä¸€ç«  è®¡ç®—æœºç³»ç»Ÿæ¦‚è¿°", "ç³»ç»Ÿå±‚æ¬¡ç»“æ„ä¸å·¥ä½œåŸç†", 30, [], ["ç†è§£å†¯Â·è¯ºä¾æ›¼è®¡ç®—æœºçš„ç‰¹ç‚¹ï¼ŒæŒæ¡è®¡ç®—æœºç¡¬ä»¶äº”å¤§éƒ¨ä»¶å’Œè½¯ä»¶åˆ†ç±»ã€‚", "ï¼ˆé‡ç‚¹ï¼‰ç†è§£â€œå­˜å‚¨ç¨‹åºâ€å·¥ä½œæ–¹å¼ï¼Œä»¥åŠé«˜çº§è¯­è¨€ç¨‹åºåˆ°å¯æ‰§è¡Œæ–‡ä»¶çš„è½¬æ¢è¿‡ç¨‹ï¼ˆç¼–è¯‘ã€é“¾æ¥ï¼‰ã€‚"]],
        ["è®¡ç®—æœºç»„æˆåŸç†", "ç¬¬ä¸€ç«  è®¡ç®—æœºç³»ç»Ÿæ¦‚è¿°", "è®¡ç®—æœºæ€§èƒ½æŒ‡æ ‡", 20, [], ["ï¼ˆé‡ç‚¹ï¼‰æŒæ¡CPUæ‰§è¡Œæ—¶é—´çš„è®¡ç®—å…¬å¼ï¼ˆ= æŒ‡ä»¤æ•° Ã— CPI Ã— æ—¶é’Ÿå‘¨æœŸï¼‰ï¼Œä»¥åŠä¸»é¢‘ã€CPIã€MIPSç­‰æŒ‡æ ‡çš„å«ä¹‰ã€‚"]],
        ["è®¡ç®—æœºç»„æˆåŸç†", "ç¬¬äºŒç«  æ•°æ®çš„è¡¨ç¤ºå’Œè¿ç®—", "æ•´æ•°çš„è¡¨ç¤ºå’Œè¿ç®—", 35, [], ["ç†Ÿç»ƒæŒæ¡çœŸå€¼ä¸åŸç ã€åç ã€è¡¥ç ã€ç§»ç ä¹‹é—´çš„è½¬æ¢ã€‚", "ï¼ˆé‡ç‚¹ï¼‰æŒæ¡è¡¥ç çš„åŠ å‡è¿ç®—æ–¹æ³•å’Œæº¢å‡ºåˆ¤æ–­ï¼ˆåŒç¬¦å·ä½æ³•ã€å•ç¬¦å·ä½æ³•ï¼‰ã€‚"]],
        ["è®¡ç®—æœºç»„æˆåŸç†", "ç¬¬äºŒç«  æ•°æ®çš„è¡¨ç¤ºå’Œè¿ç®—", "æµ®ç‚¹æ•°çš„è¡¨ç¤ºå’Œè¿ç®—", 40, [], ["ï¼ˆé‡ç‚¹ï¼‰æŒæ¡IEEE 754æ ‡å‡†çš„æ ¼å¼ï¼Œèƒ½å°†åè¿›åˆ¶æ•°ä¸å•/åŒç²¾åº¦æµ®ç‚¹æ•°ç›¸äº’è½¬æ¢ã€‚ç†è§£è§„æ ¼åŒ–ã€é˜¶ç ã€å°¾æ•°ã€‚", "ç†è§£æµ®ç‚¹æ•°çš„åŠ å‡è¿ç®—æ­¥éª¤ï¼ˆå¯¹é˜¶ã€å°¾æ•°è¿ç®—ã€è§„æ ¼åŒ–ã€èˆå…¥ã€åˆ¤æº¢å‡ºï¼‰ã€‚"]],
        ["è®¡ç®—æœºç»„æˆåŸç†", "ç¬¬ä¸‰ç«  å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„", "ä¸»å­˜å‚¨å™¨", 35, [], ["ç†è§£SRAMå’ŒDRAMçš„å·¥ä½œåŸç†å’ŒåŒºåˆ«ã€‚", "ï¼ˆé‡ç‚¹ï¼‰æŒæ¡ä¸»å­˜å®¹é‡æ‰©å±•çš„æ–¹æ³•ï¼ˆä½æ‰©å±•ã€å­—æ‰©å±•ã€å­—ä½åŒæ—¶æ‰©å±•ï¼‰å’ŒèŠ¯ç‰‡é€‰æ‹©é€»è¾‘ã€‚"]],
        ["è®¡ç®—æœºç»„æˆåŸç†", "ç¬¬ä¸‰ç«  å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„", "é«˜é€Ÿç¼“å†²å­˜å‚¨å™¨(Cache)", 45, [], ["ï¼ˆé‡ä¸­ä¹‹é‡ï¼‰ç†è§£å±€éƒ¨æ€§åŸç†ã€‚", "ç†Ÿç»ƒæŒæ¡ç›´æ¥æ˜ å°„ã€å…¨ç›¸è”æ˜ å°„ã€ç»„ç›¸è”æ˜ å°„çš„åœ°å€ç»“æ„åˆ’åˆ†ã€ä¸»å­˜å—å¦‚ä½•æ˜ å°„åˆ°Cacheå—ã€‚", "ç†è§£æ›¿æ¢ç®—æ³•ï¼ˆLRUã€FIFOï¼‰å’Œå†™ç­–ç•¥ï¼ˆå†™å›æ³•ã€å…¨å†™æ³•ï¼‰ã€‚"]],
        ["è®¡ç®—æœºç»„æˆåŸç†", "ç¬¬ä¸‰ç«  å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„", "è™šæ‹Ÿå­˜å‚¨å™¨", 40, [], ["ï¼ˆé‡ç‚¹ï¼‰ç†è§£é¡µå¼è™šæ‹Ÿå­˜å‚¨çš„åŸºæœ¬åŸç†ï¼ŒæŒæ¡é€»è¾‘åœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢è¿‡ç¨‹ï¼Œç†è§£å¿«è¡¨(TLB)åœ¨åœ°å€è½¬æ¢ä¸­çš„ä½œç”¨ã€‚"]],
        ["è®¡ç®—æœºç»„æˆåŸç†", "ç¬¬å››ç«  æŒ‡ä»¤ç³»ç»Ÿ", "å¯»å€æ–¹å¼", 30, [], ["ï¼ˆé‡ç‚¹ï¼‰æŒæ¡ç«‹å³ã€ç›´æ¥ã€é—´æ¥ã€å¯„å­˜å™¨ã€å¯„å­˜å™¨é—´æ¥ã€ç›¸å¯¹ã€åŸºå€ã€å˜å€ç­‰å¯»å€æ–¹å¼çš„å®šä¹‰ï¼Œå¹¶èƒ½æ ¹æ®æŒ‡ä»¤è®¡ç®—å‡ºæœ‰æ•ˆåœ°å€å’Œæ“ä½œæ•°ã€‚"]],
        ["è®¡ç®—æœºç»„æˆåŸç†", "ç¬¬å››ç«  æŒ‡ä»¤ç³»ç»Ÿ", "é«˜çº§è¯­è¨€ä¸æœºå™¨ä»£ç ", 25, [], ["ï¼ˆæ–°å¢é‡ç‚¹ï¼‰ç†è§£Cè¯­è¨€ä¸­çš„é€‰æ‹©ï¼ˆif-elseï¼‰ã€å¾ªç¯ï¼ˆfor/whileï¼‰ã€è¿‡ç¨‹è°ƒç”¨ï¼ˆå‡½æ•°è°ƒç”¨æ ˆï¼‰åœ¨æœºå™¨çº§çš„åŸºæœ¬å®ç°æ–¹å¼ã€‚"]],
        ["è®¡ç®—æœºç»„æˆåŸç†", "ç¬¬äº”ç«  ä¸­å¤®å¤„ç†å™¨(CPU)", "å¼‚å¸¸å’Œä¸­æ–­æœºåˆ¶", 30, [], ["ï¼ˆé‡ç‚¹ï¼‰ç†è§£ä¸­æ–­å’Œå¼‚å¸¸çš„å®šä¹‰ã€åŒºåˆ«ï¼ŒæŒæ¡ä¸­æ–­çš„æ£€æµ‹ä¸å“åº”è¿‡ç¨‹ï¼ˆä¸­æ–­å‘¨æœŸï¼‰ã€‚"]],
        ["è®¡ç®—æœºç»„æˆåŸç†", "ç¬¬äº”ç«  ä¸­å¤®å¤„ç†å™¨(CPU)", "æŒ‡ä»¤æµæ°´çº¿", 40, [], ["ï¼ˆé‡ä¸­ä¹‹é‡ï¼‰ç†è§£æµæ°´çº¿çš„æ¦‚å¿µå’Œæ€§èƒ½æŒ‡æ ‡ã€‚", "æŒæ¡ç»“æ„å†’é™©ã€æ•°æ®å†’é™©ã€æ§åˆ¶å†’é™©çš„å®šä¹‰ï¼Œä»¥åŠå¯¹åº”çš„è§£å†³æ–¹æ³•ï¼ˆæ•°æ®è½¬å‘ã€æµæ°´çº¿æš‚åœã€åˆ†æ”¯é¢„æµ‹ï¼‰ã€‚"]],
        ["è®¡ç®—æœºç»„æˆåŸç†", "ç¬¬äº”ç«  ä¸­å¤®å¤„ç†å™¨(CPU)", "å¤šå¤„ç†å™¨åŸºæœ¬æ¦‚å¿µ", 20, [], ["ï¼ˆæ–°å¢é‡ç‚¹ï¼‰ç†è§£SISDã€SIMDã€MIMDçš„åˆ†ç±»ï¼Œäº†è§£ç¡¬ä»¶å¤šçº¿ç¨‹ã€å¤šæ ¸å¤„ç†å™¨ã€å…±äº«å†…å­˜å¤šå¤„ç†å™¨(SMP)çš„åŸºæœ¬æ¦‚å¿µã€‚"]],
        ["è®¡ç®—æœºç»„æˆåŸç†", "ç¬¬å…­ç«  æ€»çº¿", "I/Oæ–¹å¼", 30, [], ["ï¼ˆé‡ç‚¹ï¼‰æŒæ¡ç¨‹åºæŸ¥è¯¢ã€ä¸­æ–­é©±åŠ¨å’ŒDMAä¸‰ç§I/Oæ–¹å¼çš„å·¥ä½œåŸç†ã€è¿‡ç¨‹ã€ä¼˜ç¼ºç‚¹å’ŒåŒºåˆ«ã€‚"]],
        ["æ“ä½œç³»ç»Ÿ", "ç¬¬ä¸€ç«  æ“ä½œç³»ç»Ÿæ¦‚è¿°", "ç¨‹åºè¿è¡Œç¯å¢ƒ", 30, [], ["ï¼ˆæ–°å¢é‡ç‚¹ï¼‰ç†è§£CPUè¿è¡Œæ¨¡å¼ï¼ˆå†…æ ¸æ€/ç”¨æˆ·æ€ï¼‰çš„åˆ‡æ¢ï¼Œä¸­æ–­å’Œå¼‚å¸¸çš„åˆ†ç±»å’Œå¤„ç†è¿‡ç¨‹ï¼Œç³»ç»Ÿè°ƒç”¨çš„å®ç°åŸç†ã€‚", "ç†è§£ç¨‹åºçš„é“¾æ¥ã€è£…å…¥è¿‡ç¨‹å’Œè¿è¡Œæ—¶çš„å†…å­˜æ˜ åƒã€‚"]],
        ["æ“ä½œç³»ç»Ÿ", "ç¬¬äºŒç«  è¿›ç¨‹ç®¡ç†", "è¿›ç¨‹ä¸çº¿ç¨‹", 35, [], ["æŒæ¡è¿›ç¨‹çš„çŠ¶æ€ï¼ˆä¸‰æ€ã€äº”æ€ã€ä¸ƒæ€æ¨¡å‹ï¼‰åŠå…¶è½¬æ¢ï¼Œç†è§£PCBçš„ä½œç”¨ã€‚", "ç†è§£è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«ä¸è”ç³»ã€‚", "ï¼ˆæ–°å¢ï¼‰æŒæ¡è¿›ç¨‹é—´é€šä¿¡(IPC)çš„ä¸»è¦æ–¹å¼ï¼šå…±äº«å†…å­˜ã€æ¶ˆæ¯ä¼ é€’ã€ç®¡é“ã€‚"]],
        ["æ“ä½œç³»ç»Ÿ", "ç¬¬äºŒç«  è¿›ç¨‹ç®¡ç†", "CPUè°ƒåº¦ä¸ä¸Šä¸‹æ–‡åˆ‡æ¢", 30, [], ["ï¼ˆé‡ç‚¹ï¼‰æŒæ¡FCFS, SJF, ä¼˜å…ˆçº§è°ƒåº¦, RR, å¤šçº§åé¦ˆé˜Ÿåˆ—ç­‰è°ƒåº¦ç®—æ³•çš„åŸç†ã€ä¼˜ç¼ºç‚¹å’Œå‘¨è½¬æ—¶é—´/å¸¦æƒå‘¨è½¬æ—¶é—´çš„è®¡ç®—ã€‚"]],
        ["æ“ä½œç³»ç»Ÿ", "ç¬¬äºŒç«  è¿›ç¨‹ç®¡ç†", "åŒæ­¥ä¸äº’æ–¥", 45, [], ["ï¼ˆé‡ä¸­ä¹‹é‡ï¼‰ç†è§£ä¸´ç•Œèµ„æºã€ä¸´ç•ŒåŒºã€‚", "ç†Ÿç»ƒæŒæ¡ä½¿ç”¨ä¿¡å·é‡å’ŒPVæ“ä½œè§£å†³ç»å…¸çš„åŒæ­¥äº’æ–¥é—®é¢˜ï¼ˆç”Ÿäº§è€…-æ¶ˆè´¹è€…ã€è¯»è€…-å†™è€…ã€å“²å­¦å®¶è¿›é¤ï¼‰ã€‚"]],
        ["æ“ä½œç³»ç»Ÿ", "ç¬¬äºŒç«  è¿›ç¨‹ç®¡ç†", "æ­»é”", 30, [], ["æŒæ¡æ­»é”äº§ç”Ÿçš„å››ä¸ªå¿…è¦æ¡ä»¶ã€‚", "ç†è§£æ­»é”çš„é¢„é˜²ã€é¿å…ï¼ˆé“¶è¡Œå®¶ç®—æ³•ï¼‰ã€æ£€æµ‹å’Œè§£é™¤ç­–ç•¥ã€‚"]],
        ["æ“ä½œç³»ç»Ÿ", "ç¬¬ä¸‰ç«  å†…å­˜ç®¡ç†", "å†…å­˜ç®¡ç†åŸºç¡€", 30, [], ["æŒæ¡è¿ç»­åˆ†é…ç®¡ç†æ–¹å¼ï¼ˆé¦–æ¬¡é€‚åº”ã€æœ€ä½³é€‚åº”ã€æœ€å·®é€‚åº”ç®—æ³•ï¼‰ã€‚", "ï¼ˆé‡ç‚¹ï¼‰æŒæ¡åˆ†é¡µç®¡ç†ã€åˆ†æ®µç®¡ç†çš„åœ°å€è½¬æ¢è¿‡ç¨‹ï¼Œä»¥åŠå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ã€‚"]],
        ["æ“ä½œç³»ç»Ÿ", "ç¬¬ä¸‰ç«  å†…å­˜ç®¡ç†", "è™šæ‹Ÿå†…å­˜ç®¡ç†", 45, [], ["ï¼ˆé‡ä¸­ä¹‹é‡ï¼‰ç†è§£è¯·æ±‚åˆ†é¡µä¸ç¼ºé¡µä¸­æ–­çš„å¤„ç†è¿‡ç¨‹ã€‚", "ç†Ÿç»ƒæŒæ¡é¡µé¢ç½®æ¢ç®—æ³•ï¼ˆOPT, FIFO, LRU, CLOCKï¼‰çš„åŸç†å’Œç¼ºé¡µæ¬¡æ•°è®¡ç®—ã€‚", "ï¼ˆæ–°å¢ï¼‰ç†è§£é¡µæ¡†åˆ†é…ä¸å›æ”¶ç­–ç•¥ï¼Œäº†è§£å†…å­˜æ˜ å°„æ–‡ä»¶çš„æ¦‚å¿µã€‚"]],
        ["æ“ä½œç³»ç»Ÿ", "ç¬¬å››ç«  æ–‡ä»¶ç®¡ç†", "æ–‡ä»¶ã€ç›®å½•ä¸æ–‡ä»¶ç³»ç»Ÿ", 40, [], ["æŒæ¡æ–‡ä»¶çš„ç‰©ç†ç»“æ„ï¼ˆè¿ç»­åˆ†é…ã€é“¾æ¥åˆ†é…ã€ç´¢å¼•åˆ†é…ï¼‰çš„åŸç†å’Œä¼˜ç¼ºç‚¹ã€‚", "ç†è§£ç¡¬é“¾æ¥å’Œè½¯é“¾æ¥çš„åŒºåˆ«ã€‚", "æŒæ¡å¤–å­˜ç©ºé—²ç©ºé—´ç®¡ç†çš„æ–¹æ³•ï¼ˆä½ç¤ºå›¾ã€ç©ºé—²é“¾è¡¨æ³•ã€æˆç»„é“¾æ¥æ³•ï¼‰ã€‚"]],
        ["æ“ä½œç³»ç»Ÿ", "ç¬¬äº”ç«  è¾“å…¥è¾“å‡º(I/O)ç®¡ç†", "I/Oç®¡ç†ä¸å¤–å­˜ç®¡ç†", 35, [], ["æŒæ¡I/Oæ§åˆ¶æ–¹å¼ï¼ˆè½®è¯¢ã€ä¸­æ–­ã€DMAï¼‰ã€‚", "ï¼ˆé‡ç‚¹ï¼‰æŒæ¡ç£ç›˜è°ƒåº¦ç®—æ³•ï¼ˆFCFS, SSTF, SCAN, C-SCAN, C-LOOKï¼‰çš„å¯»é“è¿‡ç¨‹å’Œå¯»é“æ•°è®¡ç®—ã€‚", "ç†è§£å›ºæ€ç¡¬ç›˜çš„è¯»å†™ç‰¹æ€§å’Œç£¨æŸå‡è¡¡ã€‚"]],
        ["è®¡ç®—æœºç½‘ç»œ", "ç¬¬ä¸€ç«  è®¡ç®—æœºç½‘ç»œæ¦‚è¿°", "è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„", 25, [], ["ç†Ÿç»ƒæŒæ¡OSIä¸ƒå±‚æ¨¡å‹å’ŒTCP/IPå››å±‚/äº”å±‚æ¨¡å‹çš„å„å±‚åç§°ã€åŠŸèƒ½å’Œä¸»è¦åè®®ã€‚"]],
        ["è®¡ç®—æœºç½‘ç»œ", "ç¬¬äºŒç«  ç‰©ç†å±‚", "é€šä¿¡åŸºç¡€", 25, [], ["ï¼ˆé‡ç‚¹ï¼‰ç†è§£å¹¶ä¼šåº”ç”¨å¥ˆå¥æ–¯ç‰¹å®šç†ä¸é¦™å†œå®šç†è¿›è¡Œè®¡ç®—ã€‚", "ç†è§£ç”µè·¯äº¤æ¢ã€æŠ¥æ–‡äº¤æ¢ã€åˆ†ç»„äº¤æ¢ï¼ˆæ•°æ®æŠ¥ä¸è™šç”µè·¯ï¼‰çš„åŒºåˆ«ã€‚"]],
        ["è®¡ç®—æœºç½‘ç»œ", "ç¬¬ä¸‰ç«  æ•°æ®é“¾è·¯å±‚", "å¯é ä¼ è¾“ä¸æµé‡æ§åˆ¶", 35, [], ["æŒæ¡CRCå¾ªç¯å†—ä½™ç çš„è®¡ç®—æ–¹æ³•ã€‚", "ï¼ˆé‡ç‚¹ï¼‰æŒæ¡åœæ­¢-ç­‰å¾…åè®®ã€å›é€€Nå¸§åè®®(GBN)ã€é€‰æ‹©é‡ä¼ åè®®(SR)çš„å·¥ä½œåŸç†ã€å‘é€/æ¥æ”¶çª—å£å¤§å°å’ŒåŒºåˆ«ã€‚"]],
        ["è®¡ç®—æœºç½‘ç»œ", "ç¬¬ä¸‰ç«  æ•°æ®é“¾è·¯å±‚", "ä»‹è´¨è®¿é—®æ§åˆ¶ä¸å±€åŸŸç½‘", 35, [], ["ï¼ˆé‡ç‚¹ï¼‰æŒæ¡CSMA/CDåè®®çš„å·¥ä½œåŸç†ã€å†²çªæ£€æµ‹ã€äº‰ç”¨æœŸã€æœ€å°å¸§é•¿ã€‚", "ç†è§£VLANçš„åŸºæœ¬æ¦‚å¿µä¸åŸç†ã€‚", "ç†è§£ä»¥å¤ªç½‘äº¤æ¢æœºè‡ªå­¦ä¹ å’Œè½¬å‘å¸§çš„åŸç†ã€‚"]],
        ["è®¡ç®—æœºç½‘ç»œ", "ç¬¬å››ç«  ç½‘ç»œå±‚", "IPv4", 40, [], ["ï¼ˆé‡ä¸­ä¹‹é‡ï¼‰ç†Ÿç»ƒè¿›è¡Œå­ç½‘åˆ’åˆ†å’ŒCIDRï¼ˆæ„é€ è¶…ç½‘ï¼‰çš„ç›¸å…³è®¡ç®—ï¼ˆç½‘ç»œåœ°å€ã€å¹¿æ’­åœ°å€ã€ä¸»æœºæ•°ã€å­ç½‘æ©ç ï¼‰ã€‚", "æŒæ¡ARPåè®®çš„å·¥ä½œåŸç†ã€‚"]],
        ["è®¡ç®—æœºç½‘ç»œ", "ç¬¬å››ç«  ç½‘ç»œå±‚", "è·¯ç”±ç®—æ³•ä¸åè®®", 35, [], ["ï¼ˆé‡ç‚¹ï¼‰ç†è§£è·ç¦»-å‘é‡ç®—æ³•(RIP)å’Œé“¾è·¯çŠ¶æ€ç®—æ³•(OSPF)çš„åŸºæœ¬æ€æƒ³å’ŒåŒºåˆ«ã€‚", "ç†è§£BGPåè®®çš„åŸºæœ¬æ¦‚å¿µã€‚", "ç†è§£è·¯ç”±å™¨çš„åŠŸèƒ½ï¼ŒæŒæ¡è·¯ç”±è¡¨å’Œåˆ†ç»„è½¬å‘çš„è¿‡ç¨‹ã€‚"]],
        ["è®¡ç®—æœºç½‘ç»œ", "ç¬¬äº”ç«  ä¼ è¾“å±‚", "TCPåè®®", 50, [], ["ï¼ˆé‡ä¸­ä¹‹é‡ï¼‰", "TCPè¿æ¥ç®¡ç†: ç†Ÿç»ƒæŒæ¡ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹çš„è¯¦ç»†è¿‡ç¨‹ã€çŠ¶æ€å˜è¿å’ŒæŠ¥æ–‡å†…å®¹ã€‚", "å¯é ä¼ è¾“: ç†è§£åºå·ã€ç¡®è®¤ã€è¶…æ—¶é‡ä¼ æœºåˆ¶ã€‚", "æµé‡æ§åˆ¶: ç†è§£æ»‘åŠ¨çª—å£æœºåˆ¶ã€‚", "æ‹¥å¡æ§åˆ¶: æŒæ¡æ…¢å¼€å§‹ã€æ‹¥å¡é¿å…ã€å¿«é‡ä¼ ã€å¿«æ¢å¤å››ä¸ªç®—æ³•çš„åŸç†å’Œæ‹¥å¡çª—å£å¤§å°çš„å˜åŒ–è¿‡ç¨‹ã€‚"]],
        ["è®¡ç®—æœºç½‘ç»œ", "ç¬¬å…­ç«  åº”ç”¨å±‚", "ç½‘ç»œåº”ç”¨åè®®", 30, [], ["æŒæ¡DNSï¼ˆé€’å½’/è¿­ä»£æŸ¥è¯¢ï¼‰ã€FTPï¼ˆæ§åˆ¶/æ•°æ®è¿æ¥ï¼‰ã€ç”µå­é‚®ä»¶ï¼ˆSMTP/POP3ï¼‰ã€WWWï¼ˆHTTPè¯·æ±‚æ–¹æ³•ã€çŠ¶æ€ç ã€æŒä¹…/éæŒä¹…è¿æ¥ã€Cookieï¼‰çš„å·¥ä½œåŸç†ã€‚"]]
    ];
    const MAX_WEIGHT_FOR_NEW = 50;
    const CHAPTER_MAX_DURATIONS = {
        "æ•°æ®ç»“æ„ - ç¬¬ä¸€ç«  ç»ªè®º": 45, "æ•°æ®ç»“æ„ - ç¬¬äºŒç«  çº¿æ€§è¡¨": 75, "æ•°æ®ç»“æ„ - ç¬¬ä¸‰ç«  æ ˆã€é˜Ÿåˆ—å’Œæ•°ç»„": 90, "æ•°æ®ç»“æ„ - ç¬¬å››ç«  æ ‘ä¸äºŒå‰æ ‘": 120, "æ•°æ®ç»“æ„ - ç¬¬äº”ç«  å›¾": 120, "æ•°æ®ç»“æ„ - ç¬¬å…­ç«  æŸ¥æ‰¾": 120, "æ•°æ®ç»“æ„ - ç¬¬ä¸ƒç«  æ’åº": 90,
        "è®¡ç®—æœºç»„æˆåŸç† - ç¬¬ä¸€ç«  è®¡ç®—æœºç³»ç»Ÿæ¦‚è¿°": 60, "è®¡ç®—æœºç»„æˆåŸç† - ç¬¬äºŒç«  æ•°æ®çš„è¡¨ç¤ºå’Œè¿ç®—": 90, "è®¡ç®—æœºç»„æˆåŸç† - ç¬¬ä¸‰ç«  å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„": 120, "è®¡ç®—æœºç»„æˆåŸç† - ç¬¬å››ç«  æŒ‡ä»¤ç³»ç»Ÿ": 90, "è®¡ç®—æœºç»„æˆåŸç† - ç¬¬äº”ç«  ä¸­å¤®å¤„ç†å™¨(CPU)": 120, "è®¡ç®—æœºç»„æˆåŸç† - ç¬¬å…­ç«  æ€»çº¿": 60,
        "æ“ä½œç³»ç»Ÿ - ç¬¬ä¸€ç«  æ“ä½œç³»ç»Ÿæ¦‚è¿°": 60, "æ“ä½œç³»ç»Ÿ - ç¬¬äºŒç«  è¿›ç¨‹ç®¡ç†": 120, "æ“ä½œç³»ç»Ÿ - ç¬¬ä¸‰ç«  å†…å­˜ç®¡ç†": 120, "æ“ä½œç³»ç»Ÿ - ç¬¬å››ç«  æ–‡ä»¶ç®¡ç†": 90, "æ“ä½œç³»ç»Ÿ - ç¬¬äº”ç«  è¾“å…¥è¾“å‡º(I/O)ç®¡ç†": 60,
        "è®¡ç®—æœºç½‘ç»œ - ç¬¬ä¸€ç«  è®¡ç®—æœºç½‘ç»œæ¦‚è¿°": 45, "è®¡ç®—æœºç½‘ç»œ - ç¬¬äºŒç«  ç‰©ç†å±‚": 45, "è®¡ç®—æœºç½‘ç»œ - ç¬¬ä¸‰ç«  æ•°æ®é“¾è·¯å±‚": 90, "è®¡ç®—æœºç½‘ç»œ - ç¬¬å››ç«  ç½‘ç»œå±‚": 120, "è®¡ç®—æœºç½‘ç»œ - ç¬¬äº”ç«  ä¼ è¾“å±‚": 120, "è®¡ç®—æœºç½‘ç»œ - ç¬¬å…­ç«  åº”ç”¨å±‚": 60
    };
    const WEIGHT_LABELS = { 1: "æ™®é€š", 3: "é‡ç‚¹", 5: "æ ¸å¿ƒ" };


    // --- æ ¸å¿ƒé€»è¾‘åŒº ---
    const getTodayDateString = () => new Date().toISOString().slice(0, 10);
    const storage = {
        get: (key, defaultValue = null) => { try { return JSON.parse(localStorage.getItem(key)) || defaultValue; } catch { return defaultValue; } },
        set: (key, value) => localStorage.setItem(key, JSON.stringify(value)),
    };

    function getMachineSeed() {
        let machineId = storage.get('machineId');
        if (!machineId) {
            machineId = Math.random().toString(36).substring(2, 15);
            storage.set('machineId', machineId);
        }
        return machineId;
    }

    function simpleHash(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
            const char = str.charCodeAt(i);
            hash = (hash << 5) - hash + char;
            hash |= 0;
        }
        return hash;
    }

    function mulberry32(seed) {
        return function() {
            let t = seed += 0x6D2B79F5;
            t = Math.imul(t ^ t >>> 15, t | 1);
            t ^= t + Math.imul(t ^ t >>> 7, t | 61);
            return ((t ^ t >>> 14) >>> 0) / 4294967296;
        }
    }

    function getWeightedSyllabus(history, today, subjectWeights) {
        const oneDay = 1000 * 60 * 60 * 24;
        return SYLLABUS.map(item => {
            const sectionName = item[2];
            const subjectName = item[0];
            const historyItem = history[sectionName];
            let forgettingWeight = historyItem ? (Math.log(Math.round((today - new Date(historyItem.lastReviewed)) / oneDay) + 1) * 5 + 1) : MAX_WEIGHT_FOR_NEW;
            let finalWeight = forgettingWeight * (subjectWeights[subjectName] || 3);
            return { data: item, weight: finalWeight };
        });
    }

    function generateUniqueDailyPlan(max_duration, subjectWeights) {
        const today = new Date();
        const todayStr = getTodayDateString();
        const machineSeed = getMachineSeed();
        const finalSeed = simpleHash(todayStr + machineSeed + JSON.stringify(subjectWeights) + max_duration);
        const random = mulberry32(finalSeed);

        const history = storage.get('reviewHistory', {});
        const weightedSyllabus = getWeightedSyllabus(history, today, subjectWeights);

        let review_plan = [];
        let total_duration = 0;
        const addedSections = new Set();
        const chapterDurations = {};

        const maxChapters = Math.max(2, Math.floor(max_duration / 45));

        let remainingItems = [...weightedSyllabus];
        remainingItems.sort(() => random() - 0.5);

        while (total_duration < max_duration && remainingItems.length > 0) {
            remainingItems.sort((a, b) => b.weight - a.weight);
            let chosenItem = remainingItems.shift();
            if (!chosenItem) break;

            const itemArray = chosenItem.data;
            const chapterName = `${itemArray[0]} - ${itemArray[1]}`;
            const itemDuration = itemArray[3];
            const currentChapterDuration = chapterDurations[chapterName] || 0;
            const currentChapterCount = Object.keys(chapterDurations).length;

            if (max_duration <= 120 && currentChapterCount >= maxChapters && !chapterDurations[chapterName]) continue;
            if (currentChapterDuration + itemDuration > (CHAPTER_MAX_DURATIONS[chapterName] || 999)) continue;

            review_plan.push({
                subject: itemArray[0], chapter: itemArray[1], section: itemArray[2],
                duration: itemArray[3], tags: itemArray[4], examPoints: itemArray[5], note: "", completed: false
            });
            addedSections.add(itemArray[2]);
            total_duration += itemDuration;
            chapterDurations[chapterName] = currentChapterDuration + itemDuration;
        }

        const planData = { plan: review_plan, duration: total_duration, generatedFor: max_duration };
        storage.set(`plan_${todayStr}`, planData);
        return planData;
    }

    function displayDashboard() {
        const container = document.getElementById('dashboard-container');
        const history = storage.get('reviewHistory', {});
        const today = new Date();
        const oneDay = 1000 * 60 * 60 * 24;

        let totalMemoryStrength = 0;
        SYLLABUS.forEach(s => {
            const historyItem = history[s[2]];
            const strength = historyItem ? Math.max(0.1, Math.exp(-Math.round((today - new Date(historyItem.lastReviewed)) / oneDay) / 14)) : 0.1;
            totalMemoryStrength += strength;
        });
        const overallMastery = (totalMemoryStrength / SYLLABUS.length * 100).toFixed(1);

        let timelineHTML = `
            <div class="flex justify-between items-center mt-8 mb-4">
                <h3 class="text-xl font-bold text-white">å¤ä¹ å†å²æ—¶é—´è½´</h3>
                <button id="goToCalendarBtn" class="text-sm text-sky-400 hover:text-sky-300 font-semibold">æŸ¥çœ‹å®Œæ•´æ—¥å† &rarr;</button>
            </div>
            <div class="space-y-3">`;
        for (let i = 0; i < 7; i++) {
            const date = new Date(today.getTime() - i * oneDay);
            const dateStr = date.toISOString().slice(0, 10);
            const planData = storage.get(`plan_${dateStr}`);
            if (planData && planData.plan.length > 0) {
                const completedCount = planData.plan.filter(p => p.completed).length;
                timelineHTML += `
                    <div class="timeline-item bg-gray-800 p-3 rounded-lg flex justify-between items-center" style="animation-delay: ${i * 50}ms;">
                        <div>
                            <p class="font-bold">${dateStr} ${i === 0 ? '(ä»Šæ—¥)' : ''}</p>
                            <p class="text-sm text-gray-400">å¤ä¹ äº† ${planData.plan.length} ä¸ªçŸ¥è¯†ç‚¹, å®Œæˆ ${completedCount} ä¸ª</p>
                        </div>
                        <button class="view-past-plan-btn bg-indigo-600 text-white font-bold py-1 px-3 rounded-md text-sm hover:bg-indigo-500" data-date="${dateStr}">æŸ¥çœ‹</button>
                    </div>`;
            }
        }
        timelineHTML += `</div>`;

        container.innerHTML = `
            <div class="flex justify-between items-center">
                <h1 class="text-3xl md:text-4xl font-bold text-white">408å­¦ä¹ ä»ªè¡¨ç›˜</h1>
                <button id="manageApiKeyBtn" class="text-2xl" title="è®¾ç½®API Key">âš™ï¸</button>
            </div>
            <p class="text-lg text-gray-400 my-6">æŒç»­åŠªåŠ›ï¼Œæ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹ï¼</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div class="bg-gray-800 p-4 rounded-lg text-center"><p class="text-sm text-gray-400">æ€»çŸ¥è¯†ç‚¹æŒæ¡åº¦</p><p class="text-3xl font-bold text-green-400">${overallMastery}%</p></div>
                <div class="bg-gray-800 p-4 rounded-lg text-center flex flex-col justify-center"><button id="goToStatsBtn" class="text-sky-400 font-bold text-xl hover:text-sky-300">æŸ¥çœ‹è¯¦ç»†ç»Ÿè®¡ &rarr;</button></div>
            </div>
            <button id="goToSettingsBtn" class="bg-indigo-600 text-white font-bold py-4 px-8 w-full max-w-md mx-auto rounded-full shadow-lg hover:bg-indigo-500 focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50 transform hover:-translate-y-1 transition-all duration-300 ease-in-out">
                <span class="text-xl">ğŸš€ å¼€å¯ä»Šæ—¥å¤ä¹ </span>
            </button>
            ${timelineHTML}
        `;
        switchView('dashboard-container');
        document.getElementById('goToSettingsBtn').addEventListener('click', displaySettings);
        document.getElementById('goToStatsBtn').addEventListener('click', displayStatisticsMain);
        document.getElementById('manageApiKeyBtn').addEventListener('click', showApiKeyModal);
        document.getElementById('goToCalendarBtn').addEventListener('click', () => displayFullCalendar(new Date()));
        document.querySelectorAll('.view-past-plan-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const planData = storage.get(`plan_${e.currentTarget.dataset.date}`);
                if(planData) displayHistoryDetail(planData, e.currentTarget.dataset.date);
            });
        });
    }

    function displaySettings() {
        const container = document.getElementById('settings-container');
        container.innerHTML = `
            <h1 class="text-3xl md:text-4xl font-bold text-white mb-4 text-center">å¤ä¹ è®¾ç½®</h1>
            <p class="text-lg text-gray-400 mb-6 text-center">è‡ªå®šä¹‰æ—¶é•¿ä¸ç§‘ç›®é‡ç‚¹ï¼Œç”Ÿæˆä½ çš„ä¸“å±å­¦ä¹ ä»»åŠ¡ã€‚</p>
            <div class="w-full max-w-lg mx-auto bg-gray-800 p-6 rounded-lg shadow-lg space-y-6">
                <div>
                    <label for="duration-slider" class="block text-xl font-bold text-white mb-2">å¤ä¹ æ€»æ—¶é•¿: <span id="duration-display">2.0 å°æ—¶</span></label>
                    <input type="range" id="duration-slider" min="30" max="480" step="30" value="120" class="w-full">
                </div>
                <div>
                    <h3 class="text-xl font-bold text-white mb-3">ç§‘ç›®å¤ä¹ æƒé‡</h3>
                    <div class="space-y-3">
                        <div class="grid grid-cols-3 gap-x-4 items-center">
                            <label class="text-right text-gray-300">æ•°æ®ç»“æ„</label>
                            <div class="col-span-2 weight-btn-group bg-gray-700 rounded-full p-1 flex" data-subject="æ•°æ®ç»“æ„">
                                <button data-weight="1" class="w-full text-center rounded-full py-1 text-sm transition">æ™®é€š</button>
                                <button data-weight="3" class="w-full text-center rounded-full py-1 text-sm transition active">é‡ç‚¹</button>
                                <button data-weight="5" class="w-full text-center rounded-full py-1 text-sm transition">æ ¸å¿ƒ</button>
                            </div>
                        </div>
                         <div class="grid grid-cols-3 gap-x-4 items-center">
                            <label class="text-right text-gray-300">è®¡ç»„</label>
                            <div class="col-span-2 weight-btn-group bg-gray-700 rounded-full p-1 flex" data-subject="è®¡ç»„">
                                <button data-weight="1" class="w-full text-center rounded-full py-1 text-sm transition">æ™®é€š</button>
                                <button data-weight="3" class="w-full text-center rounded-full py-1 text-sm transition active">é‡ç‚¹</button>
                                <button data-weight="5" class="w-full text-center rounded-full py-1 text-sm transition">æ ¸å¿ƒ</button>
                            </div>
                        </div>
                         <div class="grid grid-cols-3 gap-x-4 items-center">
                            <label class="text-right text-gray-300">æ“ä½œç³»ç»Ÿ</label>
                            <div class="col-span-2 weight-btn-group bg-gray-700 rounded-full p-1 flex" data-subject="æ“ä½œç³»ç»Ÿ">
                                <button data-weight="1" class="w-full text-center rounded-full py-1 text-sm transition">æ™®é€š</button>
                                <button data-weight="3" class="w-full text-center rounded-full py-1 text-sm transition active">é‡ç‚¹</button>
                                <button data-weight="5" class="w-full text-center rounded-full py-1 text-sm transition">æ ¸å¿ƒ</button>
                            </div>
                        </div>
                         <div class="grid grid-cols-3 gap-x-4 items-center">
                            <label class="text-right text-gray-300">è®¡ç½‘</label>
                            <div class="col-span-2 weight-btn-group bg-gray-700 rounded-full p-1 flex" data-subject="è®¡ç½‘">
                                <button data-weight="1" class="w-full text-center rounded-full py-1 text-sm transition">æ™®é€š</button>
                                <button data-weight="3" class="w-full text-center rounded-full py-1 text-sm transition active">é‡ç‚¹</button>
                                <button data-weight="5" class="w-full text-center rounded-full py-1 text-sm transition">æ ¸å¿ƒ</button>
                            </div>
                        </div>
                    </div>
                </div>
                <button id="generatePlanBtn" class="bg-indigo-600 text-white font-bold py-4 px-8 w-full rounded-full shadow-lg hover:bg-indigo-500 focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50 transform hover:-translate-y-1 transition-all duration-300 ease-in-out"><span class="text-xl">ğŸš€ ç”Ÿæˆä¸“å±è®¡åˆ’</span></button>
            </div>
        `;
        switchView('settings-container');

        const slider = document.getElementById('duration-slider');
        const display = document.getElementById('duration-display');
        slider.addEventListener('input', () => {
            display.textContent = `${(slider.value / 60).toFixed(1)} å°æ—¶`;
        });

        document.querySelectorAll('.weight-btn-group').forEach(group => {
            group.addEventListener('click', (e) => {
                if(e.target.tagName === 'BUTTON') {
                    group.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                }
            });
        });

        document.getElementById('generatePlanBtn').addEventListener('click', () => {
            const duration = parseInt(slider.value, 10);
            const subjectWeights = {};
            document.querySelectorAll('.weight-btn-group').forEach(group => {
                const subject = group.dataset.subject;
                const activeButton = group.querySelector('button.active');
                subjectWeights[subject] = parseInt(activeButton.dataset.weight, 10);
            });
            const planData = generateUniqueDailyPlan(duration, subjectWeights);
            displayPlan(planData);
        });
    }

    function displayPlan(planData) {
        const { plan, duration } = planData;
        const container = document.getElementById('plan-container');
        container.innerHTML = `
            <div class="flex flex-col sm:flex-row justify-between items-center mb-6">
                <div><h2 class="text-3xl font-bold text-white mb-2">ä»Šæ—¥å¤ä¹ æ¸…å•</h2><p class="text-gray-400">é¢„è®¡æ€»æ—¶é•¿: ${Math.floor(duration / 60)} å°æ—¶ ${duration % 60} åˆ†é’Ÿ</p></div>
                <div class="flex space-x-2 mt-4 sm:mt-0">
                    <button id="backToDashboardBtn" class="bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-yellow-500 transition-colors">è¿”å›ä¸»é¡µ</button>
                    <button id="showStatsBtn" class="bg-sky-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-sky-500 transition-colors">å¤ä¹ ç»Ÿè®¡</button>
                    <button id="exportBtn" class="bg-emerald-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-emerald-500 transition-colors">å¯¼å‡ºCSV</button>
                </div>
            </div>
            <div id="plan-list" class="space-y-4"></div>
            <div class="mt-6 text-center"><button id="smartSummaryBtn" class="bg-purple-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-purple-500 transition-colors">âœ¨ ä»Šæ—¥æ™ºèƒ½å°ç»“</button></div>
        `;

        const list = document.getElementById('plan-list');
        plan.forEach((item, index) => {
            const subjectColor = {'æ•°æ®ç»“æ„': 'bg-sky-500', 'è®¡ç»„': 'bg-amber-500', 'æ“ä½œç³»ç»Ÿ': 'bg-emerald-500', 'è®¡ç½‘': 'bg-rose-500'}[item.subject];
            list.insertAdjacentHTML('beforeend', `
                <div class="plan-item bg-gray-800 p-4 rounded-lg shadow-md space-y-3" style="animation-delay: ${index * 100}ms;">
                    <div class="flex items-start space-x-4">
                        <input type="checkbox" id="item-${index}" data-section-index="${index}" class="custom-checkbox flex-shrink-0 w-6 h-6 mt-1 bg-gray-700 border-gray-600 rounded-md focus:ring-2 focus:ring-indigo-500" ${item.completed ? 'checked' : ''}>
                        <div class="flex-grow">
                            <label for="item-${index}" class="cursor-pointer block">
                                <div class="flex justify-between items-baseline"><p class="font-bold text-white">${item.subject} - ${item.chapter}</p><span class="text-sm text-gray-400">${item.duration}åˆ†é’Ÿ</span></div>
                                <p class="text-gray-300 ${item.completed ? 'line-through' : ''}">${item.section}</p>
                            </label>
                        </div>
                        <div class="flex-shrink-0 flex items-center space-x-2">
                            <button class="ai-btn text-xl" data-type="explain" data-section-index="${index}" title="æ·±å…¥è§£æ">ğŸ§ </button>
                            <button class="ai-btn text-xl" data-type="question" data-section-index="${index}" title="ç”Ÿæˆç»ƒä¹ é¢˜">â“</button>
                        </div>
                    </div>
                    <div class="pl-10">
                        <textarea class="note-area w-full bg-gray-700 rounded-md p-2 text-sm text-gray-300 placeholder-gray-500 focus:ring-2 focus:ring-indigo-500 focus:outline-none"
                                  data-section-index="${index}" placeholder="åœ¨æ­¤è¾“å…¥ä½ çš„ç¬”è®°...">${item.note || ''}</textarea>
                        <button class="ai-note-btn mt-2 text-xs bg-purple-600 hover:bg-purple-500 text-white font-semibold py-1 px-3 rounded-full transition-colors"
                                data-section-index="${index}">âœ¨ AI ä¼˜åŒ–ç¬”è®°</button>
                    </div>
                </div>
            `);
        });

        switchView('plan-container');
        attachPlanEventListeners();
    }

    function displayStatisticsMain() {
        const container = document.getElementById('stats-main-container');
        const chapters = SYLLABUS.reduce((acc, item) => {
            const chapterName = `${item[0]} - ${item[1]}`;
            if (!acc.includes(chapterName)) acc.push(chapterName);
            return acc;
        }, []);

        let statsHTML = `
            <div class="flex justify-between items-center mb-6"><h2 class="text-3xl font-bold text-white">å¤ä¹ ç»Ÿè®¡ä¸­å¿ƒ</h2><button id="backToPlanBtnFromStats" class="bg-gray-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-gray-500 transition-colors">è¿”å›</button></div>
            <div class="bg-gray-800 p-4 rounded-lg shadow-md overflow-auto max-h-[70vh]"><div class="space-y-2">`;

        chapters.forEach((chapterName, index) => {
            statsHTML += `
                <button class="stat-item chapter-btn w-full text-left p-4 flex justify-between items-center hover:bg-gray-700 rounded-md transition-colors" data-chapter="${chapterName}" style="animation-delay: ${index * 20}ms;">
                    <span>${chapterName}</span>
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                </button>`;
        });

        statsHTML += `</div></div><div class="mt-6 text-center"><button id="clearHistoryBtn" class="bg-red-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-red-500 transition-colors">æ¸…é™¤æ‰€æœ‰å­¦ä¹ è®°å½•</button></div>`;

        container.innerHTML = statsHTML;
        switchView('stats-main-container');

        document.getElementById('backToPlanBtnFromStats').addEventListener('click', backToPlanOrIntro);
        document.getElementById('clearHistoryBtn').addEventListener('click', clearAllHistory);
        document.querySelectorAll('.chapter-btn').forEach(btn => {
            btn.addEventListener('click', () => displayChapterDetail(btn.dataset.chapter));
        });
    }

    function displayChapterDetail(chapterName) {
        const container = document.getElementById('chapter-detail-container');
        const history = storage.get('reviewHistory', {});
        const chapterSections = SYLLABUS.filter(item => `${item[0]} - ${item[1]}` === chapterName);
        const today = new Date();
        const oneDay = 1000 * 60 * 60 * 24;

        let totalReviews = 0, totalMemoryStrength = 0;
        let weakestTopic = { name: 'N/A', strength: 1 };

        chapterSections.forEach(s => {
            const historyItem = history[s[2]];
            totalReviews += historyItem ? historyItem.reviewCount : 0;
            const strength = historyItem ? Math.max(0.1, Math.exp(-Math.round((today - new Date(historyItem.lastReviewed)) / oneDay) / 14)) : 0.1;
            totalMemoryStrength += strength;
            if (strength < weakestTopic.strength) {
                weakestTopic = { name: s[2], strength: strength };
            }
        });
        const mastery = (totalMemoryStrength / chapterSections.length * 100).toFixed(1);

        container.innerHTML = `
            <div class="flex justify-between items-center mb-6"><h2 class="text-2xl font-bold text-white">${chapterName}</h2><button id="backToStatsMainBtn" class="bg-gray-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-gray-500 transition-colors">è¿”å›åˆ—è¡¨</button></div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="bg-gray-800 p-4 rounded-lg text-center"><p class="text-sm text-gray-400">ç« èŠ‚æŒæ¡åº¦</p><p class="text-3xl font-bold text-green-400">${mastery}%</p></div>
                <div class="bg-gray-800 p-4 rounded-lg text-center"><p class="text-sm text-gray-400">æ€»å¤ä¹ æ¬¡æ•°</p><p class="text-3xl font-bold text-sky-400">${totalReviews}</p></div>
                <div class="bg-gray-800 p-4 rounded-lg text-center"><p class="text-sm text-gray-400">å½“å‰æœ€æ˜“å¿˜</p><p class="text-lg font-bold text-red-400 truncate" title="${weakestTopic.name}">${weakestTopic.name}</p></div>
            </div>
            <div class="bg-gray-800 p-4 rounded-lg shadow-md">
                <h3 class="font-bold mb-4">é—å¿˜æ›²çº¿ (è®°å¿†å¼ºåº¦)</h3><canvas id="chapter-chart" width="400" height="200"></canvas>
                <h3 class="font-bold mt-6 mb-4">è¯¦ç»†æ•°æ®</h3><div class="overflow-auto max-h-60"><table class="w-full text-left text-sm">
                    <thead class="sticky top-0 bg-gray-800"><tr><th class="p-2">å°èŠ‚</th><th class="p-2">å¤ä¹ æ¬¡æ•°</th><th class="p-2">ä¸Šæ¬¡å¤ä¹ </th></tr></thead>
                    <tbody>${chapterSections.map(s => `
                        <tr class="border-t border-gray-700"><td class="p-2">${s[2]}</td><td class="p-2 text-center">${history[s[2]] ? history[s[2]].reviewCount : 0}</td><td class="p-2">${history[s[2]] ? history[s[2]].lastReviewed : 'ä»æœª'}</td></tr>`).join('')}
                    </tbody></table></div></div>`;

        switchView('chapter-detail-container');
        createForgettingCurveChart('chapter-chart', chapterSections, history);
        document.getElementById('backToStatsMainBtn').addEventListener('click', () => switchView('stats-main-container'));
    }

    function displayHistoryDetail(planData, dateStr) {
        const container = document.getElementById('history-detail-container');
        const { plan, duration } = planData;

        const completedCount = plan.filter(p => p.completed).length;
        const completionRate = plan.length > 0 ? (completedCount / plan.length * 100).toFixed(1) : 0;
        const subjects = [...new Set(plan.map(p => p.subject))];

        const subjectDurations = plan.reduce((acc, item) => {
            if (item.completed) {
                acc[item.subject] = (acc[item.subject] || 0) + item.duration;
            }
            return acc;
        }, {});

        container.innerHTML = `
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold text-white">å¤ä¹ å¤ç›˜: ${dateStr}</h2>
                <button id="backToDashboardFromHistory" class="bg-gray-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-gray-500 transition-colors">è¿”å›ä¸»é¡µ</button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="bg-gray-800 p-4 rounded-lg text-center"><p class="text-sm text-gray-400">å®Œæˆç‡</p><p class="text-3xl font-bold text-green-400">${completionRate}%</p></div>
                <div class="bg-gray-800 p-4 rounded-lg text-center"><p class="text-sm text-gray-400">æ€»è€—æ—¶</p><p class="text-3xl font-bold text-sky-400">${(duration/60).toFixed(1)}å°æ—¶</p></div>
                <div class="bg-gray-800 p-4 rounded-lg text-center"><p class="text-sm text-gray-400">å¤ä¹ ç§‘ç›®æ•°</p><p class="text-3xl font-bold text-purple-400">${subjects.length}</p></div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-gray-800 p-4 rounded-lg shadow-md">
                    <h3 class="font-bold mb-4">å„ç§‘è€—æ—¶åˆ†å¸ƒ (å·²å®Œæˆ)</h3>
                    <canvas id="history-pie-chart" width="400" height="400"></canvas>
                </div>
                <div class="bg-gray-800 p-4 rounded-lg shadow-md overflow-auto max-h-[50vh]">
                    <h3 class="font-bold mb-4">å¤ä¹ é¡¹ä¸ç¬”è®°</h3>
                    <div class="space-y-4">
                    ${plan.map(item => `
                        <div class="border-b border-gray-700 pb-2">
                            <p class="font-semibold ${item.completed ? 'text-green-400' : 'text-yellow-400'}">${item.completed ? '[å®Œæˆ]' : '[æœªå®Œæˆ]'} ${item.section}</p>
                            ${item.note ? `<p class="text-sm text-gray-400 mt-1 pl-4 border-l-2 border-gray-600"><strong>ç¬”è®°:</strong> ${item.note}</p>` : ''}
                        </div>
                    `).join('')}
                    </div>
                </div>
            </div>
        `;
        switchView('history-detail-container');
        createHistoryPieChart('history-pie-chart', subjectDurations);
        document.getElementById('backToDashboardFromHistory').addEventListener('click', () => switchView('dashboard-container'));
    }

    function displayFullCalendar(date) {
        const container = document.getElementById('full-calendar-container');
        const month = date.getMonth();
        const year = date.getFullYear();

        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        let calendarHTML = `
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold text-white">å­¦ä¹ æ—¥å†</h2>
                <button id="backToDashboardFromCalendar" class="bg-gray-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-gray-500 transition-colors">è¿”å›ä¸»é¡µ</button>
            </div>
            <div class="bg-gray-800 p-4 rounded-lg shadow-md">
                <div class="flex justify-between items-center mb-4">
                    <button id="prev-month" class="p-2 rounded-md hover:bg-gray-700">&lt;</button>
                    <h3 class="text-xl font-bold">${year}å¹´ ${month + 1}æœˆ</h3>
                    <button id="next-month" class="p-2 rounded-md hover:bg-gray-700">&gt;</button>
                </div>
                <div class="grid calendar-grid gap-1 text-center text-xs font-bold text-gray-400 mb-2">
                    <div>æ—¥</div><div>ä¸€</div><div>äºŒ</div><div>ä¸‰</div><div>å››</div><div>äº”</div><div>å…­</div>
                </div>
                <div id="calendar-body" class="grid calendar-grid gap-1">`;

        for (let i = 0; i < firstDay; i++) {
            calendarHTML += `<div></div>`;
        }

        for (let day = 1; day <= daysInMonth; day++) {
            const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            const planData = storage.get(`plan_${dateStr}`);
            let bgColor = 'bg-gray-700';
            if (planData && planData.plan.length > 0) {
                const completedCount = planData.plan.filter(p => p.completed).length;
                if (completedCount > 0) {
                    if (completedCount <= 2) bgColor = 'bg-green-900';
                    else if (completedCount <= 5) bgColor = 'bg-green-700';
                    else bgColor = 'bg-green-500';
                }
            }

            calendarHTML += `<div class="h-16 p-1 text-left rounded-md ${bgColor} ${planData ? 'cursor-pointer hover:ring-2 ring-indigo-400' : ''}" data-date="${dateStr}">
                <span class="font-bold">${day}</span>
            </div>`;
        }

        calendarHTML += `</div></div>`;
        container.innerHTML = calendarHTML;
        switchView('full-calendar-container');

        document.getElementById('backToDashboardFromCalendar').addEventListener('click', () => switchView('dashboard-container'));
        document.getElementById('prev-month').addEventListener('click', () => displayFullCalendar(new Date(year, month - 1, 1)));
        document.getElementById('next-month').addEventListener('click', () => displayFullCalendar(new Date(year, month + 1, 1)));
        document.querySelectorAll('.calendar-grid div[data-date]').forEach(cell => {
            cell.addEventListener('click', (e) => {
                const planData = storage.get(`plan_${e.currentTarget.dataset.date}`);
                if(planData) displayHistoryDetail(planData, e.currentTarget.dataset.date);
            });
        });
    }

    function createHistoryPieChart(canvasId, subjectDurations) {
        const canvas = document.getElementById(canvasId);
        if (!canvas) return;
        if (canvas.chart) canvas.chart.destroy();

        const labels = Object.keys(subjectDurations);
        const data = Object.values(subjectDurations);
        const backgroundColors = ['rgba(59, 130, 246, 0.7)', 'rgba(234, 179, 8, 0.7)', 'rgba(16, 185, 129, 0.7)', 'rgba(244, 63, 94, 0.7)'];

        canvas.chart = new Chart(canvas.getContext('2d'), {
            type: 'pie',
            data: {
                labels: labels,
                datasets: [{
                    label: 'è€—æ—¶ (åˆ†é’Ÿ)',
                    data: data,
                    backgroundColor: backgroundColors,
                    borderColor: '#1f2937',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { position: 'top', labels: { color: '#cbd5e1' } } }
            }
        });
    }

    function attachPlanEventListeners() {
        document.querySelectorAll('.custom-checkbox').forEach(c => c.addEventListener('change', handleCheckboxChange));
        document.getElementById('exportBtn').addEventListener('click', exportToCSV);
        document.getElementById('showStatsBtn').addEventListener('click', displayStatisticsMain);
        document.querySelectorAll('.ai-btn').forEach(b => b.addEventListener('click', handleAIButtonClick));
        document.getElementById('smartSummaryBtn').addEventListener('click', handleSmartSummary);
        document.getElementById('backToDashboardBtn').addEventListener('click', () => {
            if (confirm("æ‚¨ç¡®å®šè¦æ”¾å¼ƒå½“å‰è®¡åˆ’å¹¶è¿”å›ä¸»é¡µå—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚")) {
                switchView('dashboard-container');
            }
        });
        document.querySelectorAll('.note-area').forEach(textarea => textarea.addEventListener('blur', handleNoteChange));
        document.querySelectorAll('.ai-note-btn').forEach(btn => btn.addEventListener('click', handleAINoteOptimize));
    }

    function createForgettingCurveChart(canvasId, chapterSections, history) {
        const canvas = document.getElementById(canvasId);
        if (!canvas) return;
        if (canvas.chart) canvas.chart.destroy();

        const today = new Date();
        const oneDay = 1000 * 60 * 60 * 24;
        const labels = chapterSections.map(s => s[2].split(' ')[0]);
        const data = chapterSections.map(s => {
            const historyItem = history[s[2]];
            if (!historyItem) return 0.1;
            const daysSince = Math.round((today - new Date(historyItem.lastReviewed)) / oneDay);
            return Math.max(0.1, Math.exp(-daysSince / 14));
        });

        canvas.chart = new Chart(canvas.getContext('2d'), {
            type: 'bar',
            data: { labels: labels, datasets: [{
                    label: 'è®°å¿†å¼ºåº¦ (è¶Šé«˜è¶Šå¥½)', data: data,
                    backgroundColor: data.map(d => d < 0.5 ? 'rgba(255, 99, 132, 0.6)' : 'rgba(75, 192, 192, 0.6)'),
                    borderColor: data.map(d => d < 0.5 ? 'rgba(255, 99, 132, 1)' : 'rgba(75, 192, 192, 1)'),
                    borderWidth: 1 }]
            },
            options: {
                scales: { y: { beginAtZero: true, max: 1, ticks: { color: '#cbd5e1' } }, x: { ticks: { color: '#cbd5e1' } } },
                plugins: { legend: { labels: { color: '#cbd5e1' } } }
            }
        });
    }

    function handleCheckboxChange(event) {
        const checkbox = event.target, sectionIndex = checkbox.dataset.sectionIndex, isCompleted = checkbox.checked;
        checkbox.closest('.plan-item').querySelector('.text-gray-300').classList.toggle('line-through', isCompleted);

        const todayStr = getTodayDateString();
        const planData = storage.get(`plan_${todayStr}`);
        const item = planData.plan[sectionIndex];
        if (item) item.completed = isCompleted;
        storage.set(`plan_${todayStr}`, planData);

        if (isCompleted) {
            const history = storage.get('reviewHistory', {});
            const sectionName = item.section;
            const historyItem = history[sectionName] || { reviewCount: 0 };
            historyItem.lastReviewed = todayStr;
            historyItem.reviewCount = (historyItem.reviewCount || 0) + 1;
            history[sectionName] = historyItem;
            storage.set('reviewHistory', history);
        }
    }

    function handleNoteChange(event) {
        const textarea = event.target;
        const sectionIndex = textarea.dataset.sectionIndex;
        const todayStr = getTodayDateString();
        const planData = storage.get(`plan_${todayStr}`);
        if (planData && planData.plan[sectionIndex]) {
            planData.plan[sectionIndex].note = textarea.value;
            storage.set(`plan_${todayStr}`, planData);
        }
    }

    function exportToCSV() {
        const todayStr = getTodayDateString();
        const planData = storage.get(`plan_${todayStr}`);
        if (!planData || !planData.plan) return alert('æ²¡æœ‰å¯å¯¼å‡ºçš„è®¡åˆ’ã€‚');

        let csvContent = "data:text/csv;charset=utf-8,\uFEFF" + "ç§‘ç›®,ç« èŠ‚,å°èŠ‚,å®ŒæˆçŠ¶æ€,ç¬”è®°,å¤ä¹ æ—¥æœŸ\r\n";
        planData.plan.forEach(item => {
            const note = item.note ? `"${item.note.replace(/"/g, '""')}"` : "";
            csvContent += [`"${item.subject}"`, `"${item.chapter}"`, `"${item.section}"`, item.completed ? "å·²å®Œæˆ" : "æœªå®Œæˆ", note, todayStr].join(",") + "\r\n";
        });

        const link = document.createElement("a");
        link.setAttribute("href", encodeURI(csvContent));
        link.setAttribute("download", `408-å¤ä¹ è®¡åˆ’-${todayStr}.csv`);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    function clearAllHistory() {
        if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰å­¦ä¹ è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
            localStorage.clear();
            alert('æ‰€æœ‰è®°å½•å·²æ¸…é™¤ã€‚');
            switchView('dashboard-container');
            location.reload();
        }
    }

    function switchView(viewId) {
        document.querySelectorAll('.view-container').forEach(el => {
            if (el.id === viewId) {
                el.classList.remove('hidden-view');
                el.style.position = 'relative';
            } else {
                el.classList.add('hidden-view');
                el.style.position = 'absolute';
            }
        });
    }

    function backToPlanOrIntro() {
        const todayPlan = storage.get(`plan_${getTodayDateString()}`);
        if (todayPlan) switchView('plan-container');
        else switchView('dashboard-container');
    }

    // --- Modal & AI Section ---
    const aiModal = {
        backdrop: document.getElementById('ai-modal-backdrop'),
        title: document.getElementById('ai-modal-title'),
        loading: document.getElementById('ai-loading'),
        result: document.getElementById('ai-result'),
    };
    const notesModal = {
        backdrop: document.getElementById('notes-modal-backdrop'),
        title: document.getElementById('notes-modal-title'),
        textarea: document.getElementById('notes-textarea'),
        saveBtn: document.getElementById('save-note-btn'),
    };
    const apiKeyModal = {
        backdrop: document.getElementById('api-key-modal-backdrop'),
        input: document.getElementById('api-key-input'),
        saveBtn: document.getElementById('save-api-key-btn'),
        closeBtn: document.getElementById('api-key-modal-close'),
    };

    function showModal(modal, title) {
        if(modal.title) modal.title.textContent = title;
        if(modal.result) modal.result.innerHTML = '';
        if(modal.loading) modal.loading.style.display = 'flex';
        modal.backdrop.classList.remove('hidden');
    }

    function hideModal(modal) {
        modal.backdrop.classList.add('hidden');
    }

    document.querySelectorAll('.modal-close').forEach(btn => btn.addEventListener('click', (e) => hideModal(e.currentTarget.closest('.modal-backdrop').id.includes('ai-modal') ? aiModal : notesModal)));
    document.querySelectorAll('.modal-backdrop').forEach(bd => bd.addEventListener('click', (e) => { if (e.target === bd) hideModal(bd.id.includes('ai-modal') ? aiModal : notesModal)}));
    apiKeyModal.closeBtn.addEventListener('click', () => hideModal(apiKeyModal));


    function showApiKeyModal() {
        apiKeyModal.input.value = storage.get('apiKey', '');
        apiKeyModal.backdrop.classList.remove('hidden');
    }
    apiKeyModal.saveBtn.addEventListener('click', () => {
        const key = apiKeyModal.input.value.trim();
        if (key) {
            storage.set('apiKey', key);
            hideModal(apiKeyModal);
            alert('APIå¯†é’¥å·²ä¿å­˜ï¼');
        } else {
            alert('è¯·è¾“å…¥æœ‰æ•ˆçš„APIå¯†é’¥ã€‚');
        }
    });


    async function callAI(prompt, targetTextarea = null) {
        const apiKey = storage.get('apiKey');
        if (!apiKey) {
            alert("è¯·å…ˆè®¾ç½®æ‚¨çš„AI APIå¯†é’¥ï¼");
            showApiKeyModal();
            return;
        }

        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
            });

            const data = await response.json();

            if (!response.ok) {
                const errorMessage = data.error ? data.error.message : `API request failed with status ${response.status}`;
                if (response.status === 400 || response.status === 403) {
                    alert('APIå¯†é’¥æ— æ•ˆæˆ–è¯·æ±‚æ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥æ‚¨çš„å¯†é’¥ã€‚');
                    showApiKeyModal();
                }
                throw new Error(errorMessage);
            }

            if (!data.candidates || data.candidates.length === 0 || !data.candidates[0].content || !data.candidates[0].content.parts) {
                console.error("Invalid response structure from AI:", data);
                throw new Error("AIè¿”å›äº†æ— æ•ˆæˆ–ç©ºçš„å“åº”ã€‚");
            }

            const text = data.candidates[0].content.parts[0].text;
            aiModal.loading.style.display = 'none';
            aiModal.result.textContent = text;

            if (targetTextarea) {
                targetTextarea.value = text;
                targetTextarea.dispatchEvent(new Event('input', { bubbles: true }));
            }

        } catch (error) {
            console.error("AI API call failed:", error);
            aiModal.loading.style.display = 'none';
            aiModal.result.textContent = `æŠ±æ­‰ï¼ŒAIåŠ©æ‰‹å‡ºé”™äº†ã€‚\né”™è¯¯ä¿¡æ¯: ${error.message}`;
        }
    }

    function handleAIButtonClick(event) {
        const { type, sectionIndex } = event.currentTarget.dataset;
        const todayStr = getTodayDateString();
        const planData = storage.get(`plan_${todayStr}`);
        const item = planData.plan[sectionIndex];
        const topic = item.section;
        const examPoints = item.examPoints.join('\n- ');

        let prompt = "", title = "";

        if (type === 'explain') {
            title = `âœ¨ æ·±å…¥è§£æ: ${topic}`;
            prompt = `ä½œä¸ºä¸€åèµ„æ·±çš„è®¡ç®—æœºç§‘å­¦æ•™è‚²è€…ï¼Œè¯·ä»¥ä¸¥è°¨ã€å­¦æœ¯çš„å£å»ï¼Œä¸ºæ­£åœ¨å¤‡è€ƒ408çš„è®¡ç®—æœºä¸“ä¸šå­¦ç”Ÿæ·±å…¥è§£æâ€œ${topic}â€è¿™ä¸€çŸ¥è¯†ç‚¹ã€‚è¯·å›´ç»•ä»¥ä¸‹å…·ä½“è€ƒç‚¹å±•å¼€ï¼š\n- ${examPoints}\n\nå†…å®¹åº”åŒ…æ‹¬å…¶æ ¸å¿ƒå®šä¹‰ã€å…³é”®åŸç†/ç‰¹å¾ï¼Œä»¥åŠåœ¨è®¡ç®—æœºç³»ç»Ÿä¸­çš„å…¸å‹åº”ç”¨åœºæ™¯ã€‚è¯·ç¡®ä¿å†…å®¹å‡†ç¡®ã€ç²¾ç‚¼ï¼Œå¹¶ä½¿ç”¨ä¸­æ–‡å›ç­”ã€‚`;
        } else if (type === 'question') {
            title = `âœ¨ éšå ‚ç»ƒä¹ : ${topic}`;
            prompt = `ä½œä¸ºä¸€å408è®¡ç®—æœºè€ƒç ”çš„å‘½é¢˜ä¸“å®¶ï¼Œè¯·ä¸¥æ ¼ä»¿ç…§è€ƒç ”çœŸé¢˜çš„é£æ ¼ï¼Œå¹¶ç´§å¯†å›´ç»•ä»¥ä¸‹ä¸€ä¸ªæˆ–å¤šä¸ªå…·ä½“è€ƒç‚¹ï¼Œå‡ºä¸€é“é«˜è´¨é‡çš„å•é¡¹é€‰æ‹©é¢˜ã€‚\nè€ƒç‚¹ï¼š\n- ${examPoints}\n\nè¦æ±‚é¢˜å¹²ä¸¥è°¨ï¼Œé€‰é¡¹å…·æœ‰è¿·æƒ‘æ€§ã€‚æœ€åè¯·ç»™å‡ºæ­£ç¡®ç­”æ¡ˆå’Œè¯¦å°½çš„è§£æã€‚è¯·ç”¨ä¸­æ–‡å›ç­”ã€‚`;
        }
        showModal(aiModal, title);
        callAI(prompt);
    }

    function handleNoteButtonClick(event) {
        const { sectionIndex } = event.currentTarget.dataset;
        const todayStr = getTodayDateString();
        const planData = storage.get(`plan_${todayStr}`);
        const item = planData.plan[sectionIndex];

        notesModal.textarea.value = item.note || "";
        showModal(notesModal, `ç¬”è®°: ${item.section}`);

        const newSaveBtn = notesModal.saveBtn.cloneNode(true);
        notesModal.saveBtn.parentNode.replaceChild(newSaveBtn, notesModal.saveBtn);
        notesModal.saveBtn = newSaveBtn;

        notesModal.saveBtn.addEventListener('click', () => {
            item.note = notesModal.textarea.value;
            storage.set(`plan_${todayStr}`, planData);
            hideModal(notesModal);
        });
    }

    function handleAINoteOptimize(event) {
        const button = event.currentTarget;
        const sectionIndex = button.dataset.sectionIndex;
        const todayStr = getTodayDateString();
        const planData = storage.get(`plan_${todayStr}`);
        const item = planData.plan[sectionIndex];
        const userNote = item.note || "";
        const topic = item.section;

        if (userNote.trim() === "") {
            alert("è¯·å…ˆè¾“å…¥ä¸€äº›ç¬”è®°å†…å®¹å†è®©AIä¼˜åŒ–å“¦ï¼");
            return;
        }

        const title = `âœ¨ æ­£åœ¨ä¼˜åŒ–ç¬”è®°: ${topic}`;
        const prompt = `ä½œä¸ºä¸€åé¡¶çº§çš„408è®¡ç®—æœºè€ƒç ”è¾…å¯¼è€å¸ˆï¼Œè¯·å°†ä»¥ä¸‹å­¦ç”Ÿé’ˆå¯¹â€œ${topic}â€è¿™ä¸ªçŸ¥è¯†ç‚¹å†™çš„ç¬”è®°è¿›è¡Œä¼˜åŒ–ã€‚è¦æ±‚ï¼š1. ç»“æ„åŒ–å¤„ç†ï¼Œä½¿ç”¨ç‚¹å¥æˆ–ç¼–å·è®©é€»è¾‘æ›´æ¸…æ™°ã€‚2. ä¿®æ­£æ¦‚å¿µé”™è¯¯ï¼Œè¡¥å……å…³é”®çš„é—æ¼ç‚¹ã€‚3. è¯­è¨€ç²¾ç‚¼ï¼Œçªå‡ºé‡ç‚¹ï¼Œä½¿å…¶æ›´é€‚åˆèƒŒè¯µå’Œè®°å¿†ã€‚4. ç›´æ¥è¿”å›ä¼˜åŒ–åçš„ç¬”è®°å†…å®¹ï¼Œæ— éœ€é¢å¤–è¯´æ˜ã€‚å­¦ç”Ÿçš„åŸå§‹ç¬”è®°æ˜¯ï¼š\n\n"${userNote}"`;

        showModal(aiModal, title);
        const targetTextarea = document.querySelector(`textarea[data-section-index="${sectionIndex}"]`);
        callAI(prompt, targetTextarea);
    }

    function handleSmartSummary() {
        const todayStr = getTodayDateString();
        const planData = storage.get(`plan_${todayStr}`);
        if (!planData || !planData.plan) return;
        const topicList = planData.plan.map(item => `${item.subject}çš„"${item.section.split(' ')[0]}"`).join('ã€');
        const title = "âœ¨ ä»Šæ—¥æ™ºèƒ½å°ç»“";
        const prompt = `æˆ‘æ˜¯ä¸€åæ­£åœ¨å¤‡è€ƒ408è®¡ç®—æœºè€ƒç ”çš„å­¦ç”Ÿï¼Œä»Šå¤©çš„å¤ä¹ å†…å®¹åŒ…æ‹¬ï¼š${topicList}ã€‚è¯·ä½ ä»¥ä¸€ä½èµ„æ·±è€å¸ˆçš„è§†è§’ï¼Œä¸ºæˆ‘ç”Ÿæˆä¸€æ®µ150å­—å·¦å³çš„æ€»ç»“ï¼Œç‚¹å‡ºè¿™äº›çŸ¥è¯†ç‚¹ä¹‹é—´çš„å†…åœ¨è”ç³»ï¼Œæˆ–è€…å®ƒä»¬åœ¨è®¡ç®—æœºç§‘å­¦ä½“ç³»ä¸­çš„ä½ç½®å’Œé‡è¦æ€§ã€‚è¯·ç”¨ä¸­æ–‡å›ç­”ã€‚`;
        showModal(aiModal, title);
        callAI(prompt);
    }

    // --- é¡µé¢åŠ è½½é€»è¾‘ ---
    window.addEventListener('load', () => {
        const todayStr = getTodayDateString();
        const savedPlan = storage.get(`plan_${todayStr}`);
        const apiKey = storage.get('apiKey');

        if (!apiKey) {
            showApiKeyModal();
        }

        if (savedPlan) {
            displayPlan(savedPlan);
        } else {
            displayDashboard();
        }
    });
</script>

</body>
</html>
